<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Книги - Библиотека</title>
    <link rel="stylesheet" href="../styles/styles.css">
</head>
<body>
    <header>
        <div class="header-top">
            <div class="logo">
                <a href="../index.html">
                    <img src="../images/logo.png" alt="Логотип библиотеки" class="logo-image">
                </a>
            </div>
            <div class="auth-buttons">
                <a href="login.html" class="btn">Вход/регистрация</a>
            </div>
        </div>
        <nav class="main-nav">
            <ul>
                <li><a href="../index.html">главная</a></li>
                <li><a href="#">Личный кабинет</a></li>
                <li><a href="books.html">Книги</a></li>
                <li><a href="genres.html">Жанры</a></li>
                <li><a href="cart.html">Корзина</a></li>
                <li><a href="reviews.html">Отзывы</a></li>
                <li><a href="#">Контактные данные</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <aside class="sidebar">
            <ul>
                <li><a href="books.html">Книги</a></li>
                <li><a href="#">Дата выдачи/возврата</a></li>
                <li><a href="cart.html">Корзина</a></li>
                <li><a href="#">Звонок в библиотеку</a></li>
                <li><a href="#">Информация для юр. лиц</a></li>
                <li><a href="about.html">Сведения об организации</a></li>
            </ul>
        </aside>

        <main class="content">
            <h1>Каталог книг</h1>

            <!-- ПОИСК И ФИЛЬТРЫ -->
            <div class="books-filter">
                <h3>Поиск книг</h3>
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Введите название книги или автора..." onkeyup="searchBooks()">
                </div>
                <div class="filter-grid">
                    <div class="filter-group">
                        <label>Жанр</label>
                        <select id="genre-filter" onchange="searchBooks()">
                            <option value="">Все жанры</option>
                            <option value="роман">Роман</option>
                            <option value="современная">Современная литература</option>
                            <option value="классика">Классическая литература</option>
                            <option value="зарубежная">Зарубежная литература</option>
                            <option value="русская">Русская литература</option>
                            <option value="детектив">Детективы</option>
                            <option value="фантастика">Фантастика</option>
                            <option value="фэнтези">Фэнтези</option>
                            <option value="поэзия">Поэзия</option>
                            <option value="научная">Научная литература</option>
                            <option value="исторический">Исторический</option>
                            <option value="биография">Биография</option>
                            <option value="приключения">Приключения</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Автор</label>
                        <input type="text" id="author-filter" placeholder="ФИО автора" onkeyup="searchBooks()">
                    </div>
                    <div class="filter-group">
                        <label>Год издания</label>
                        <select id="year-filter" onchange="searchBooks()">
                            <option value="">Любой год</option>
                            <option value="2020">2020-2024</option>
                            <option value="2010">2010-2019</option>
                            <option value="2000">2000-2009</option>
                            <option value="1990">1990-1999</option>
                            <option value="1980">1980-1989</option>
                            <option value="1970">1970-1979</option>
                            <option value="1960">1960-1969</option>
                            <option value="1950">1950-1959</option>
                            <option value="1940">1940-1949</option>
                            <option value="1900">До 1940</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Доступность</label>
                        <select id="availability-filter" onchange="searchBooks()">
                            <option value="">Все книги</option>
                            <option value="available">В наличии</option>
                            <option value="borrowed">Выданы</option>
                        </select>
                    </div>
                </div>
                <div class="filter-actions">
                    <button onclick="resetFilters()" class="reset-btn">Сбросить фильтры</button>
                </div>
            </div>

            <div class="books-grid">
                <!-- Современная литература -->
                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/lavr.jpg');"></div>
                    <div class="book-content">
                        <h4>Лавр</h4>
                        <p class="book-author"><strong>Автор:</strong> Евгений Водолазкин</p>
                        <p class="book-genre"><strong>Жанр:</strong> Современная литература, Роман</p>
                        <p class="book-year"><strong>Год:</strong> 2012</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <div class="book-item">
                    <div class="book-image" style="background-image: url('..//images/books/zuleikha.jpg');"></div>
                    <div class="book-content">
                        <h4>Зулейха открывает глаза</h4>
                        <p class="book-author"><strong>Автор:</strong> Гузель Яхина</p>
                        <p class="book-genre"><strong>Жанр:</strong> Современная литература, Исторический роман</p>
                        <p class="book-year"><strong>Год:</strong> 2015</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <!-- Классическая литература -->
                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/crime-and-punishment.jpg');"></div>
                    <div class="book-content">
                        <h4>Преступление и наказание</h4>
                        <p class="book-author"><strong>Автор:</strong> Фёдор Достоевский</p>
                        <p class="book-genre"><strong>Жанр:</strong> Классическая литература, Роман</p>
                        <p class="book-year"><strong>Год:</strong> 1866</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/war-and-peace.jpg');"></div>
                    <div class="book-content">
                        <h4>Война и мир</h4>
                        <p class="book-author"><strong>Автор:</strong> Лев Толстой</p>
                        <p class="book-genre"><strong>Жанр:</strong> Классическая литература, Роман-эпопея</p>
                        <p class="book-year"><strong>Год:</strong> 1869</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/anna-karenina.jpg');"></div>
                    <div class="book-content">
                        <h4>Анна Каренина</h4>
                        <p class="book-author"><strong>Автор:</strong> Лев Толстой</p>
                        <p class="book-genre"><strong>Жанр:</strong> Классическая литература, Роман</p>
                        <p class="book-year"><strong>Год:</strong> 1877</p>
                        <p class="book-status borrowed"><strong>Статус:</strong> Выдана</p>
                    </div>
                </div>

                <!-- Зарубежная литература -->
                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/1984.jpg');"></div>
                    <div class="book-content">
                        <h4>1984</h4>
                        <p class="book-author"><strong>Автор:</strong> Джордж Оруэлл</p>
                        <p class="book-genre"><strong>Жанр:</strong> Зарубежная литература, Антиутопия</p>
                        <p class="book-year"><strong>Год:</strong> 1949</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/to-kill-a-mockingbird.jpg');"></div>
                    <div class="book-content">
                        <h4>Убить пересмешника</h4>
                        <p class="book-author"><strong>Автор:</strong> Харпер Ли</p>
                        <p class="book-genre"><strong>Жанр:</strong> Зарубежная литература, Роман</p>
                        <p class="book-year"><strong>Год:</strong> 1960</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/great-gatsby.jpg');"></div>
                    <div class="book-content">
                        <h4>Великий Гэтсби</h4>
                        <p class="book-author"><strong>Автор:</strong> Фрэнсис Скотт Фицджеральд</p>
                        <p class="book-genre"><strong>Жанр:</strong> Зарубежная литература, Роман</p>
                        <p class="book-year"><strong>Год:</strong> 1925</p>
                        <p class="book-status borrowed"><strong>Статус:</strong> Выдана</p>
                    </div>
                </div>

                <!-- Русская литература -->
                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/master-and-margarita.jpg');"></div>
                    <div class="book-content">
                        <h4>Мастер и Маргарита</h4>
                        <p class="book-author"><strong>Автор:</strong> Михаил Булгаков</p>
                        <p class="book-genre"><strong>Жанр:</strong> Русская литература, Роман</p>
                        <p class="book-year"><strong>Год:</strong> 1967</p>
                        <p class="book-status borrowed"><strong>Статус:</strong> Выдана</p>
                    </div>
                </div>

                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/quiet-don.jpg');"></div>
                    <div class="book-content">
                        <h4>Тихий Дон</h4>
                        <p class="book-author"><strong>Автор:</strong> Михаил Шолохов</p>
                        <p class="book-genre"><strong>Жанр:</strong> Русская литература, Роман-эпопея</p>
                        <p class="book-year"><strong>Год:</strong> 1940</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/eugene-onegin.jpg');"></div>
                    <div class="book-content">
                        <h4>Евгений Онегин</h4>
                        <p class="book-author"><strong>Автор:</strong> Александр Пушкин</p>
                        <p class="book-genre"><strong>Жанр:</strong> Русская литература, Роман в стихах</p>
                        <p class="book-year"><strong>Год:</strong> 1833</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <!-- Детективы -->
                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/murder-orient-express.jpg');"></div>
                    <div class="book-content">
                        <h4>Убийство в Восточном экспрессе</h4>
                        <p class="book-author"><strong>Автор:</strong> Агата Кристи</p>
                        <p class="book-genre"><strong>Жанр:</strong> Детектив</p>
                        <p class="book-year"><strong>Год:</strong> 1934</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/ten-little-niggers.jpg');"></div>
                    <div class="book-content">
                        <h4>Десять негритят</h4>
                        <p class="book-author"><strong>Автор:</strong> Агата Кристи</p>
                        <p class="book-genre"><strong>Жанр:</strong> Детектив</p>
                        <p class="book-year"><strong>Год:</strong> 1939</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <!-- Фантастика и фэнтези -->
                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/harry-potter.jpg');"></div>
                    <div class="book-content">
                        <h4>Гарри Поттер и философский камень</h4>
                        <p class="book-author"><strong>Автор:</strong> Джоан Роулинг</p>
                        <p class="book-genre"><strong>Жанр:</strong> Фэнтези</p>
                        <p class="book-year"><strong>Год:</strong> 1997</p>
                        <p class="book-status borrowed"><strong>Статус:</strong> Выдана</p>
                    </div>
                </div>

                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/lord-of-rings.jpg');"></div>
                    <div class="book-content">
                        <h4>Властелин колец: Братство кольца</h4>
                        <p class="book-author"><strong>Автор:</strong> Джон Р. Р. Толкин</p>
                        <p class="book-genre"><strong>Жанр:</strong> Фэнтези</p>
                        <p class="book-year"><strong>Год:</strong> 1954</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/fahrenheit-451.jpg');"></div>
                    <div class="book-content">
                        <h4>451° по Фаренгейту</h4>
                        <p class="book-author"><strong>Автор:</strong> Рэй Брэдбери</p>
                        <p class="book-genre"><strong>Жанр:</strong> Фантастика, Антиутопия</p>
                        <p class="book-year"><strong>Год:</strong> 1953</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <!-- Поэзия -->
                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/ahmatova-poems.jpg');"></div>
                    <div class="book-content">
                        <h4>Стихотворения и поэмы</h4>
                        <p class="book-author"><strong>Автор:</strong> Анна Ахматова</p>
                        <p class="book-genre"><strong>Жанр:</strong> Поэзия</p>
                        <p class="book-year"><strong>Год:</strong> 2020</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <!-- Научная литература -->
                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/brief-history-time.jpg');"></div>
                    <div class="book-content">
                        <h4>Краткая история времени</h4>
                        <p class="book-author"><strong>Автор:</strong> Стивен Хокинг</p>
                        <p class="book-genre"><strong>Жанр:</strong> Научная литература</p>
                        <p class="book-year"><strong>Год:</strong> 1988</p>
                        <p class="book-status available"><strong>Статус:</strong> В наличии</p>
                    </div>
                </div>

                <div class="book-item">
                    <div class="book-image" style="background-image: url('../images/books/sapiens.jpg');"></div>
                    <div class="book-content">
                        <h4>Sapiens: Краткая история человечества</h4>
                        <p class="book-author"><strong>Автор:</strong> Юваль Ной Харари</p>
                        <p class="book-genre"><strong>Жанр:</strong> Научная литература</p>
                        <p class="book-year"><strong>Год:</strong> 2011</p>
                        <p class="book-status borrowed"><strong>Статус:</strong> Выдана</p>
                    </div>
                </div>
            </div>

            <div id="no-results" style="display: none; text-align: center; padding: 2rem; background: white; border-radius: 8px;">
                <h3>Книги не найдены</h3>
                <p>Попробуйте изменить параметры поиска</p>
            </div>
        </main>
    </div>

    <footer>
        <p>© 2025 Библиотека Ростова-на-Дону. Все права защищены.</p>
    </footer>

    <script>
        function getUrlParameter(name) {
            name = name.replace(/[\[\]]/g, '\\$&');
            const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
            const results = regex.exec(window.location.search);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Функция для применения фильтра по жанру из URL
        function applyGenreFilterFromUrl() {
            const genreFromUrl = getUrlParameter('genre');

            if (genreFromUrl) {
                // Сопоставление параметров URL с значениями в фильтре
                const genreMap = {
                    'modern': 'роман',
                    'classic': 'классика',
                    'foreign': 'зарубежная',
                    'russian': 'русская',
                    'detective': 'детектив',
                    'fantasy': 'фантастика',
                    'poetry': 'поэзия',
                    'science': 'научная'
                };

                const filterValue = genreMap[genreFromUrl] || genreFromUrl;

                // Устанавливаем значение в фильтр жанра
                const genreFilter = document.getElementById('genre-filter');
                if (genreFilter) {
                    genreFilter.value = filterValue;
                    // Запускаем поиск
                    searchBooks();
                }
            }
        }

        // Функция для применения фильтра из sessionStorage
        function applyGenreFilterFromStorage() {
            const savedGenre = sessionStorage.getItem('selectedGenre');
            if (savedGenre) {
                const genreMap = {
                    'modern': 'современная',
                    'classic': 'классика',
                    'foreign': 'зарубежная',
                    'russian': 'русская',
                    'detective': 'детектив',
                    'fantasy': 'фантастика',
                    'poetry': 'поэзия',
                    'science': 'научная'
                };

                const filterValue = genreMap[savedGenre] || savedGenre;

                const genreFilter = document.getElementById('genre-filter');
                if (genreFilter) {
                    genreFilter.value = filterValue;
                    if (typeof searchBooks === 'function') {
                        searchBooks();
                    }
                }

                // Очищаем storage после применения
                sessionStorage.removeItem('selectedGenre');
            }
        }

        // Функция для поиска книг
        function searchBooks() {
            const searchText = document.getElementById('search-input').value.toLowerCase();
            const genre = document.getElementById('genre-filter').value.toLowerCase();
            const author = document.getElementById('author-filter').value.toLowerCase();
            const year = document.getElementById('year-filter').value;
            const availability = document.getElementById('availability-filter').value;

            const books = document.querySelectorAll('.book-item');
            let foundAny = false;

            books.forEach(book => {
                const bookTitle = book.querySelector('h4').textContent.toLowerCase();
                const bookAuthor = book.querySelector('.book-author').textContent.toLowerCase();
                const bookGenre = book.querySelector('.book-genre').textContent.toLowerCase();
                const bookYearText = book.querySelector('.book-year').textContent;
                const bookStatus = book.querySelector('.book-status').textContent;

                // Извлекаем год из текста
                const bookYearMatch = bookYearText.match(/\d+/);
                const bookYear = bookYearMatch ? parseInt(bookYearMatch[0]) : 0;

                // Проверка поискового запроса
                const searchMatch = !searchText ||
                    bookTitle.includes(searchText) ||
                    bookAuthor.includes(searchText);

                // Проверка жанра - специальная обработка для романа
                let genreMatch = !genre;
                if (genre) {
                    if (genre === 'роман') {
                        // Ищем любые упоминания романа
                        genreMatch = bookGenre.includes('роман');
                    } else {
                        genreMatch = bookGenre.includes(genre);
                    }
                }

                // Проверка автора
                const authorMatch = !author || bookAuthor.includes(author);

                // Проверка года - исправленная логика
                let yearMatch = true;
                if (year) {
                    switch (year) {
                        case '2020':
                            yearMatch = bookYear >= 2020;
                            break;
                        case '2010':
                            yearMatch = bookYear >= 2010 && bookYear <= 2019;
                            break;
                        case '2000':
                            yearMatch = bookYear >= 2000 && bookYear <= 2009;
                            break;
                        case '1990':
                            yearMatch = bookYear >= 1990 && bookYear <= 1999;
                            break;
                        case '1980':
                            yearMatch = bookYear >= 1980 && bookYear <= 1989;
                            break;
                        case '1970':
                            yearMatch = bookYear >= 1970 && bookYear <= 1979;
                            break;
                        case '1960':
                            yearMatch = bookYear >= 1960 && bookYear <= 1969;
                            break;
                        case '1950':
                            yearMatch = bookYear >= 1950 && bookYear <= 1959;
                            break;
                        case '1940':
                            yearMatch = bookYear >= 1940 && bookYear <= 1949;
                            break;
                        case '1900':
                            yearMatch = bookYear < 1940; // Все книги до 1940 года
                            break;
                        default:
                            yearMatch = true;
                    }
                }

                // Проверка доступности
                const availabilityMatch = !availability ||
                    (availability === 'available' && bookStatus.includes('В наличии')) ||
                    (availability === 'borrowed' && bookStatus.includes('Выдана'));

                if (searchMatch && genreMatch && authorMatch && yearMatch && availabilityMatch) {
                    book.style.display = 'block';
                    foundAny = true;
                } else {
                    book.style.display = 'none';
                }
            });

            // Показать сообщение, если ничего не найдено
            const noResults = document.getElementById('no-results');
            if (noResults) {
                noResults.style.display = foundAny ? 'none' : 'block';
            }
        }

        // Функция сброса фильтров
        function resetFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('genre-filter').value = '';
            document.getElementById('author-filter').value = '';
            document.getElementById('year-filter').value = '';
            document.getElementById('availability-filter').value = '';
            searchBooks();
        }

        // Инициализация поиска при загрузке страницы
        document.addEventListener('DOMContentLoaded', function () {
            // Сначала пробуем применить фильтр из URL
            applyGenreFilterFromUrl();
            // Затем из sessionStorage (для переходов со страницы жанров)
            applyGenreFilterFromStorage();
            // Запускаем поиск
            searchBooks();
        });
    </script>
    <script>
        // Функция для плавного перехода между страницами
        function smoothNavigate(url) {
            // Добавляем класс для анимации исчезновения
            document.body.classList.add('page-exit');

            // Ждем окончания анимации и переходим
            setTimeout(() => {
                window.location.href = url;
            }, 400);
        }

        // Обработчик для всех внутренних ссылок
        document.addEventListener('DOMContentLoaded', function () {
            const allLinks = document.querySelectorAll('a[href]');

            allLinks.forEach(link => {
                const href = link.getAttribute('href');

                // Проверяем, что это внутренняя ссылка (не внешняя и не якорь)
                if (href &&
                    !href.startsWith('http') &&
                    !href.startsWith('//') &&
                    !href.startsWith('#') &&
                    !href.startsWith('javascript:') &&
                    (href.endsWith('.html') || href === 'index.html' || href === '/')) {

                    link.addEventListener('click', function (e) {
                        e.preventDefault();
                        smoothNavigate(href);
                    });
                }
            });

            // Особые обработчики для кнопок жанров (если они есть на странице)
            const genreButtons = document.querySelectorAll('.genre-button');
            genreButtons.forEach(button => {
                button.addEventListener('click', function (e) {
                    e.preventDefault();
                    const genre = this.getAttribute('data-genre');
                    if (genre) {
                        sessionStorage.setItem('selectedGenre', genre);
                    }
                    smoothNavigate('books.html');
                });
            });

            // Особые обработчики для изображений слайдера (если они есть на странице)
            const slideImages = document.querySelectorAll('.slide-image');
            slideImages.forEach(slide => {
                slide.addEventListener('click', function () {
                    const genre = this.getAttribute('onclick')?.match(/goToGenre\('([^']+)'\)/)?.[1];
                    if (genre) {
                        sessionStorage.setItem('selectedGenre', genre);
                        smoothNavigate('books.html');
                    }
                });
            });
        });

        // Функция для обновления существующей функции goToGenre
        if (typeof goToGenre === 'undefined') {
            function goToGenre(genre) {
                sessionStorage.setItem('selectedGenre', genre);
                smoothNavigate('books.html');
            }
        } else {
            // Сохраняем старую функцию и создаем новую
            const oldGoToGenre = goToGenre;
            window.goToGenre = function (genre) {
                sessionStorage.setItem('selectedGenre', genre);
                smoothNavigate('books.html');
            };
        }
    </script>
</body>
</html>